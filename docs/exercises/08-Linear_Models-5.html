<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 08</title>

<script src="08-Linear_Models-5_files/header-attrs/header-attrs.js"></script>
<script src="08-Linear_Models-5_files/jquery/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link href="08-Linear_Models-5_files/bootstrap/bootstrap.min.css" rel="stylesheet" />
<script src="08-Linear_Models-5_files/bootstrap/bootstrap.bundle.min.js"></script>
<script src="08-Linear_Models-5_files/bs3compat/transition.js"></script>
<script src="08-Linear_Models-5_files/bs3compat/tabs.js"></script>
<script src="08-Linear_Models-5_files/bs3compat/bs3compat.js"></script>
<script src="08-Linear_Models-5_files/jqueryui/jquery-ui.min.js"></script>
<link href="08-Linear_Models-5_files/tocify/jquery.tocify.css" rel="stylesheet" />
<script src="08-Linear_Models-5_files/tocify/jquery.tocify.js"></script>
<script src="08-Linear_Models-5_files/navigation/tabsets.js"></script>
<link href="08-Linear_Models-5_files/highlightjs/default.css" rel="stylesheet" />
<script src="08-Linear_Models-5_files/highlightjs/highlight.js"></script>
<script src="08-Linear_Models-5_files/clipboard/clipboard.min.js"></script>
<link href="08-Linear_Models-5_files/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
<script src="08-Linear_Models-5_files/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
<script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"Press Ctrl+C to Copy"})</script>
<link href="08-Linear_Models-5_files/font-awesome/css/all.css" rel="stylesheet" />
<link href="08-Linear_Models-5_files/font-awesome/css/v4-shims.css" rel="stylesheet" />

<script type="text/javascript">

  $(document).ready(function () {
    
    const ttl = $('.title.toc-ignore').text();
    const subttl = $('.subtitle').text();
    
    $('.title.toc-ignore').remove();
    $('.subtitle').remove();
    
    $('<h1 class = "title toc-ignore">' + ttl + '</h1><h3 class = "subtitle">' + subttl + '</h3>')
      .appendTo('.tocify');
    
    $('.section.level2:first').show();
      
  });
  
  $(window).on('load', function() {
  
    $('.tocify-item.list-group-item').click(function(event){
        
      $('.section.level2').hide();
      
      var id = $(this).data('unique');
      
      $('#'+id).show(100, function(){
        $('html').scrollTop(0);
      });
      
    });
  
  });

</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">Lab 08</h1>
<h3 class="subtitle">Linear Model Extensions</h3>

</div>


<div id="Outline" class="section level2">
<h2>Outline</h2>
<p><strong>TL;DR</strong> modifying tables, qualitative variables, scaling and centering, ANOVA.</p>
<p><strong>Caution!</strong> Please note that all labs assume that you are working in an RStudio Project directory!</p>
<div id="objectives" class="section level3">
<h3>Objectives</h3>
<p>This lab will guide you through the process of</p>
<ol style="list-style-type: decimal">
<li>Modifying tables by
<ul>
<li>Adding or changing variables with <code>mutate()</code></li>
<li>Grouping variables and aggregating with <code>group_by()</code> and <code>summary()</code></li>
</ul></li>
<li>Extending linear models with qualitative variables
<ul>
<li>including groups as constant offsets</li>
<li>including groups as interaction effects</li>
</ul></li>
<li>Making linear models more interpretable by
<ul>
<li>centering variables on their central tendency</li>
<li>scaling variables</li>
<li>standardizing variables</li>
</ul></li>
</ol>
</div>
<div id="r-packages" class="section level3">
<h3>R Packages</h3>
<p>We will be using the following packages:</p>
<ul>
<li><a href="https://dplyr.tidyverse.org/">dplyr</a></li>
<li><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></li>
</ul>
<p>To install these packages, <strong>run the following code in your console</strong>:</p>
<pre class="r"><code>install.packages(
  c(&quot;dplyr&quot;, &quot;palmerpenguins&quot;)
)</code></pre>
<p><strong>Note:</strong> You should not <code>install.packages()</code> in an Rmd document. Use that function in your R console instead. Then use <code>library()</code> as part of the preamble in your Rmd document to check packages out of the library and use them in that R session. This should always go at the start of your document!</p>
<pre class="r"><code>library(dplyr)
library(palmerpenguins)</code></pre>
</div>
<div id="data" class="section level3">
<h3>Data</h3>
<ul>
<li><code>penguins</code>
<ul>
<li>Includes measurements for penguin species, island in Palmer Archipelago, size (flipper length, body mass, bill dimensions), and sex.</li>
<li>package: <code>palmerpenguins</code></li>
<li>reference: <a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="uri">https://allisonhorst.github.io/palmerpenguins/reference/penguins.html</a></li>
</ul></li>
</ul>
</div>
</div>
<div id="Mutating_Data" class="section level2">
<h2>Mutating Data</h2>
<p>It is often the case that you will want to change a variable in your data or add new variables. This can be done with the <code>mutate()</code> function from the <code>dplyr</code> package. It is inspired by the base R <code>transform()</code> function, which works in much the same way. Here, we will learn how to use <code>mutate()</code> to change and add variables. The syntax is similar to other <code>dplyr</code> verbs we’ve learned already. The first argument is always the data. After that, you can specify <code>variable = value</code> or <code>key = value</code> pairs like you would when constructing a regular old data.frame.</p>
<p>For instance, making a table looks like this:</p>
<pre class="r"><code>data.frame(
  x = 1:5,
  y = 6:10
)

# or

tibble(
  x = 1:5,
  y = 6:10
)</code></pre>
<p>And mutating a table looks like this:</p>
<pre class="r"><code>mutate(
  penguins,
  id = 1:n(),
  bill_length_cm = bill_length_mm/10
)
## # A tibble: 344 x 10
##    species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##    &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
##  1 Adelie  Torgersen           39.1          18.7               181        3750
##  2 Adelie  Torgersen           39.5          17.4               186        3800
##  3 Adelie  Torgersen           40.3          18                 195        3250
##  4 Adelie  Torgersen           NA            NA                  NA          NA
##  5 Adelie  Torgersen           36.7          19.3               193        3450
##  6 Adelie  Torgersen           39.3          20.6               190        3650
##  7 Adelie  Torgersen           38.9          17.8               181        3625
##  8 Adelie  Torgersen           39.2          19.6               195        4675
##  9 Adelie  Torgersen           34.1          18.1               193        3475
## 10 Adelie  Torgersen           42            20.2               190        4250
## # ... with 334 more rows, and 4 more variables: sex &lt;fct&gt;, year &lt;int&gt;,
## #   id &lt;int&gt;, bill_length_cm &lt;dbl&gt;</code></pre>
<p>Here we change the <code>penguins</code> table in two ways. First, we add a new variable <code>id</code>. The values it takes are integers from 1 to the number of penguins in the table (344 in this case). Notice that we refer to the total number using the function <code>n()</code>. This is a convenience function that works only inside <code>dplyr</code> verbs. Second, we add a variable <code>bill_length_cm</code> by adding a conversion to the original variable <code>bill_length_mm</code> (dividing by 10), thus converting from millimeters to centimeters.</p>
<p>Recall that data frames or tables are <em>rectangular</em>. That means each variable in the table must have the same number of <em>values</em> (equal to the number of rows or <em>observations</em> in the table). In the penguins table, there are 344 observations, so any new variable that you add with <code>mutate()</code> must have 344 values (it must have that length). If the variable you want to add does not have the same length, you will receive an error like the following:</p>
<pre class="r"><code>mutate(
  penguins,
  id = 1:5
)
## Error: Problem with `mutate()` column `id`.
## i `id = 1:5`.
## i `id` must be size 344 or 1, not 5.</code></pre>
<p>Note that you can refer to new variables you have created in the same <code>mutate()</code> call.</p>
<pre class="r"><code>penguins_small &lt;- select(penguins, species, island)

mutate(
  penguins_small,
  id = 1:n(),
  id2 = id * 2
)
## # A tibble: 344 x 4
##    species island       id   id2
##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt; &lt;dbl&gt;
##  1 Adelie  Torgersen     1     2
##  2 Adelie  Torgersen     2     4
##  3 Adelie  Torgersen     3     6
##  4 Adelie  Torgersen     4     8
##  5 Adelie  Torgersen     5    10
##  6 Adelie  Torgersen     6    12
##  7 Adelie  Torgersen     7    14
##  8 Adelie  Torgersen     8    16
##  9 Adelie  Torgersen     9    18
## 10 Adelie  Torgersen    10    20
## # ... with 334 more rows</code></pre>
<div id="variable-creation-functions" class="section level3">
<h3>Variable creation functions</h3>
<p>R provides a number of extremely useful functions for creating new variables. These functions are <strong>vectorized</strong>, meaning they work with an input variable (or <em>vector</em> in R parlance) to create a new output variable having the same length as the input. Rather than enumerate all of the vectorized functions available in R, let me just list a few of the more useful ones here.</p>
<ul>
<li>Arithmetic operators like <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>, for example, <code>x^2</code> (x-squared) and <code>x/10</code> (x divided by 10). These can be combined with aggregate functions to create useful variables like <code>x / sum(x)</code> for proportions and <code>y - mean(y)</code> for the difference from the mean (ie, errors or residuals).</li>
<li>Log and exponent with <code>log()</code> and <code>exp()</code>.</li>
<li>Cumulative or rolling aggregates with <code>cumsum()</code>, <code>cumprod()</code>, <code>cummin()</code>, <code>cummax()</code>, and <code>cummean()</code> (this one is provided by <code>dplyr</code>), for example</li>
</ul>
<pre class="r"><code>x
## [1] 1 2 3 4 5
cumsum(x)
## [1]  1  3  6 10 15
cummean(x)
## [1] 1.0 1.5 2.0 2.5 3.0</code></pre>
<ul>
<li>Logical comparison operators like <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code>, and <code>==</code>. These all return logical values (<code>TRUE</code> and <code>FALSE</code>).</li>
</ul>
<pre class="r"><code>x
## [1] 1 2 3 4 5
x &gt;= 3
## [1] FALSE FALSE  TRUE  TRUE  TRUE
x != 2
## [1]  TRUE FALSE  TRUE  TRUE  TRUE</code></pre>
</div>
<div id="exercises" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li>Use <code>mutate()</code> on the <code>penguins</code> data to create variables that
<ul>
<li>represent body mass in kilograms,</li>
<li>represent bill depth in centimeters,</li>
<li>compare bill length to bill depth to see whether the former is greater than (<code>&gt;</code>) the latter.</li>
</ul></li>
</ol>
</div>
</div>
<div id="Summarizing_Data" class="section level2">
<h2>Summarizing Data</h2>
<p>In addition to adding or changing variables with <code>mutate()</code>, <code>dplyr</code> also provides functionality to summarize data with - you guessed it - <code>summarize()</code> (if you prefer the Queen’s English, you can actually write this as <code>summarise()</code>). This collapses a table to a single row:</p>
<pre class="r"><code>summarize(
  penguins, 
  mean_bill_length = mean(bill_length_mm, na.rm = TRUE)
)
## # A tibble: 1 x 1
##   mean_bill_length
##              &lt;dbl&gt;
## 1             43.9</code></pre>
<p>One really powerful way to use this function pairs it with <code>group_by()</code>, which produces a summary for each specified group in the data. For example,</p>
<pre class="r"><code>penguin_species &lt;- group_by(penguins, species)

summarize(
  penguin_species,
  mean_bill_length = mean(bill_length_mm, na.rm = TRUE),
  var_bill_length = var(bill_length_mm, na.rm = TRUE)
)
## # A tibble: 3 x 3
##   species   mean_bill_length var_bill_length
##   &lt;fct&gt;                &lt;dbl&gt;           &lt;dbl&gt;
## 1 Adelie                38.8            7.09
## 2 Chinstrap             48.8           11.2 
## 3 Gentoo                47.5            9.50</code></pre>
<p>Under the hood, what this is doing is splitting the table into three tables, one for each penguin species, then summarizing those individual tables, and putting the results back together.</p>
<p>Note that you can summarize by multiple groups.</p>
<pre class="r"><code>penguin_species_island &lt;- group_by(penguins, species, island)

summarize(
  penguin_species_island,
  mean_bill_length = mean(bill_length_mm, na.rm = TRUE),
  var_bill_length = var(bill_length_mm, na.rm = TRUE)
)
## # A tibble: 5 x 4
## # Groups:   species [3]
##   species   island    mean_bill_length var_bill_length
##   &lt;fct&gt;     &lt;fct&gt;                &lt;dbl&gt;           &lt;dbl&gt;
## 1 Adelie    Biscoe                39.0            6.15
## 2 Adelie    Dream                 38.5            6.08
## 3 Adelie    Torgersen             39.0            9.15
## 4 Chinstrap Dream                 48.8           11.2 
## 5 Gentoo    Biscoe                47.5            9.50</code></pre>
<div id="exercises-1" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li>Group the penguins data by species and summarize the mean flipper length.</li>
<li>Group the penguins data by island and count the number of penguins on each. Hint: you can use <code>n()</code> to do this.</li>
<li>Group the penguins data by sex and summarize the mean and variance in body mass.</li>
<li>Group the penguins data by sex and species and summarize the mean and variance in body mass.</li>
</ol>
</div>
</div>
<div id="The_Piping" class="section level2">
<h2>The Pipe</h2>
<pre class="r"><code>knitr::include_graphics(&quot;https://upload.wikimedia.org/wikipedia/en/b/b9/MagrittePipe.jpg&quot;)</code></pre>
<p><img src="https://upload.wikimedia.org/wikipedia/en/b/b9/MagrittePipe.jpg" style="display: block; margin: auto;" /></p>
<p>Up to now, if we wanted to make a series of changes to our data, we had to save to intermediate objects or overwrite the object we were working with. For example,</p>
<pre class="r"><code>bob &lt;- select(penguins, species, island, bill_length_mm, body_mass_g)
tom &lt;- filter(bob, sex == &quot;male&quot;)
sue &lt;- mutate(tom, bill_length_squared = bill_length_mm^2)

remove(bob, tom)</code></pre>
<p>Sometimes, you might see people write the same series of function calls this way:</p>
<pre class="r"><code>sue &lt;- mutate(filter(select(penguins, species, island, bill_length_mm, body_mass_g), island == &quot;Torgersen&quot;), bill_length_squared = bill_length_mm^2)</code></pre>
<p>This is called nesting. It is fine as long as it remains relatively <em>shallow</em>, but the deeper the nest (like 2 or 3 functions deep), the harder it is to read, as you must follow results from the inside out and bottom up, as opposed to left to right and top down, which is more natural.</p>
<p>To avoid deep nests <em>and</em> temporary assignments, you can use a common programming technique called piping. To pipe code in R, <code>dplyr</code> provides a special operator, <code>%&gt;%</code>. It works like this:</p>
<pre class="r"><code>penguins %&gt;% 
  select(species, sex, body_mass_g) %&gt;% 
  filter(sex == &quot;male&quot;) %&gt;% 
  group_by(species) %&gt;% 
  summarize(
    mean_body_mass = mean(body_mass_g, na.rm = TRUE)
  )
## # A tibble: 3 x 2
##   species   mean_body_mass
##   &lt;fct&gt;              &lt;dbl&gt;
## 1 Adelie             4043.
## 2 Chinstrap          3939.
## 3 Gentoo             5485.</code></pre>
<p>If you were to transpose this code into a natural language like English, it would sound something like this,</p>
<blockquote>
<p>Take the penguins take, then select the variables species, sex, and body mass, then filter the males, then group by species, and then calculate the mean body mass for each species.</p>
</blockquote>
<p>The ‘then’ in each case is the pipe operator. Crucially, the pipe assumes that the data being transformed is the first argument to the function, which is true for all the <code>dplyr</code> functions (and, in fact, all the functions in the <code>tidyverse</code>) as they were all designed very intentionally to work with the pipe. Unfortunately, many parts of R were written long before the pipe was ever introduced, so they may not work as easily with it.</p>
<p>This is easily one of the most powerful tools for working with data in R, which is probably why it is so popular these days. RStudio gives a keyboard shortcut to make inserting this operator into your code easier. It’s <code>Ctrl + Shift + M</code> on Windows and <code>Cmd + Shift + M</code> on Mac.</p>
<div id="exercises-2" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li>Try piping the penguins data through <code>select()</code>, <code>filter()</code>, <code>mutate()</code>, <code>group_by()</code>, and <code>summarize()</code>. Do all of the following:
<ul>
<li>Select species, island, and body mass,</li>
<li>Filter the Adelie penguin species,</li>
<li>Mutate body mass, converting from grams to kilograms,</li>
<li>Group by island, and</li>
<li>Summarize the data to get the mean and variance of body mass.</li>
</ul></li>
<li>Try piping the penguins data through <code>select()</code>, <code>mutate()</code>, <code>group_by()</code>, and <code>summarize()</code>. Do all of the following:
<ul>
<li>Select species, island, sex, and flipper length,</li>
<li>Mutate flipper length, converting from millimeters to centimeters,</li>
<li>Group by species, island, sex, and</li>
<li>Summarize the data to get the mean and variance of flipper length (cm) for each island.</li>
</ul></li>
</ol>
</div>
</div>
<div id="Qualitative_Variables" class="section level2">
<h2>Qualitative Variables</h2>
<p>Shade-loving plants thrive in areas that get less sunlight. Sun-loving plants thrive in areas that get more. This is a fairly intuitive and uncontroversial idea, but how would we incorporate this kind of difference between groups into a linear model? In R, we use dummy variables that re-code a qualitative variable into a numeric variable with two values, zero for the reference group (every member of this group has value zero) and one for the comparison group (every member of this group has value one). For a qualitative variable with m categories, it takes m-1 dummy variables to code it. You can do this manually if you like, but R will do it for you, too. All you need do is include the qualitative variable in the model formula. This can be done in one of two ways: either by adding the variable with <code>+</code> or multiplying the variable with <code>*</code>.</p>
<p>Let’s look at the penguins data to see how this works.</p>
<pre class="r"><code>lm_base &lt;- lm(bill_length_mm ~ body_mass_g, data = penguins) 

summary(lm_base)
## 
## Call:
## lm(formula = bill_length_mm ~ body_mass_g, data = penguins)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -10.125  -3.043  -0.809   2.071  16.111 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2.69e+01   1.27e+00    21.2   &lt;2e-16 ***
## body_mass_g 4.05e-03   2.97e-04    13.6   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.39 on 340 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.354,  Adjusted R-squared:  0.352 
## F-statistic:  186 on 1 and 340 DF,  p-value: &lt;2e-16</code></pre>
<p>Here we have a perfectly respectable model of a familiar allometric relationship between length and weight. Both the intercept and the coefficient for body mass are significant, and it explains 35% of the variation in bill length, but can we do better?</p>
<div id="intercept-offset" class="section level3">
<h3>Intercept Offset</h3>
<p>Maybe some species have longer bills on average than other species. To incorporate this idea, we can add a constant offset to the intercept representing the difference in mean bill length for each species. This is done by adding the <code>species</code> variable in the formula.</p>
<pre class="r"><code>lm_species_offset &lt;- lm(bill_length_mm ~ body_mass_g + species, data = penguins) 

summary(lm_species_offset)
## 
## Call:
## lm(formula = bill_length_mm ~ body_mass_g + species, data = penguins)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.813 -1.672  0.134  1.472  9.290 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      2.49e+01   1.06e+00   23.44  &lt; 2e-16 ***
## body_mass_g      3.75e-03   2.82e-04   13.28  &lt; 2e-16 ***
## speciesChinstrap 9.92e+00   3.51e-01   28.26  &lt; 2e-16 ***
## speciesGentoo    3.56e+00   4.86e-01    7.32  1.8e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.4 on 338 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.808,  Adjusted R-squared:  0.806 
## F-statistic:  474 on 3 and 338 DF,  p-value: &lt;2e-16</code></pre>
<p>Hello! This model explains 80% of the variance and it’s coefficients are all significant. But, is the difference between this more complex, species-sensitive model and the simpler, species-insensitive model real or just a happy accident? As always, we can perform an ANOVA to find out.</p>
<pre class="r"><code>anova(lm_base, lm_species_offset)
## Analysis of Variance Table
## 
## Model 1: bill_length_mm ~ body_mass_g
## Model 2: bill_length_mm ~ body_mass_g + species
##   Res.Df  RSS Df Sum of Sq   F Pr(&gt;F)    
## 1    340 6564                            
## 2    338 1952  2      4613 399 &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>With a p-value really, really closer to zero, the answer is Yes, the species-sensitive model with a constant offset does indeed explain significantly more of the variance in bill length than we would expect by chance.</p>
</div>
<div id="interactions" class="section level3">
<h3>Interactions</h3>
<p>What about interactions? Is it possible that penguin species not only have differences in mean bill length, but they also have different relationships between bill length and body mass? To answer this question, we can multiply <code>body_mass_g</code> by the <code>species</code> variable in the model formula.</p>
<pre class="r"><code>lm_species_interaction &lt;- lm(bill_length_mm ~ body_mass_g * species, data = penguins) 

summary(lm_species_interaction)
## 
## Call:
## lm(formula = bill_length_mm ~ body_mass_g * species, data = penguins)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.421 -1.646  0.092  1.472  9.314 
## 
## Coefficients:
##                               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                  26.994139   1.592601   16.95  &lt; 2e-16 ***
## body_mass_g                   0.003188   0.000427    7.46  7.3e-13 ***
## speciesChinstrap              5.180054   3.274672    1.58     0.11    
## speciesGentoo                -0.254591   2.713866   -0.09     0.93    
## body_mass_g:speciesChinstrap  0.001275   0.000874    1.46     0.15    
## body_mass_g:speciesGentoo     0.000903   0.000607    1.49     0.14    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.4 on 336 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.81,   Adjusted R-squared:  0.807 
## F-statistic:  286 on 5 and 336 DF,  p-value: &lt;2e-16</code></pre>
<p>First thing to note here. In addition to providing an intercept estimate, the model provides estimates of the difference in intercept for Chinstrap and Gentoo. In this case, the Adelie penguins are the reference class, so the intercept represents their marginal mean bill length when they have zero body mass (zero body mass?), and <code>speciesChinstrap</code> and <code>speciesGentoo</code> are differences in those species and Adelie. Here, of course, those differences are not significantly different.</p>
<p>Second thing to note. In addition to providing a slope estimate for body mass, the model includes separate slope estimate for Chinstrap and Gentoo. Again, the reference class is Adelie, so the coefficient estimate for <code>body_mass_g</code> represents the relationship between bill length and body for Adelie penguins, and <code>body_mass_g:speciesChinstrap</code> and <code>body_mass_g:speciesGentoo</code> represent differences in that relationship for those species relative to Adelie penguins.</p>
<p>As you can see, most of these coefficients are non-significant. It appears that the relationship between body mass and bill length is fairly robust across species. Still, we might wonder whether the model as a whole does better than the base model and the offset only model. To find out, let’s turn again to the ANOVA.</p>
<pre class="r"><code>anova(lm_base, lm_species_offset, lm_species_interaction)
## Analysis of Variance Table
## 
## Model 1: bill_length_mm ~ body_mass_g
## Model 2: bill_length_mm ~ body_mass_g + species
## Model 3: bill_length_mm ~ body_mass_g * species
##   Res.Df  RSS Df Sum of Sq      F Pr(&gt;F)    
## 1    340 6564                               
## 2    338 1952  2      4613 400.80 &lt;2e-16 ***
## 3    336 1933  2        19   1.62    0.2    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Perhaps unsurprisingly, the intercept only model is significantly better than the species-insensitive model, but the interaction model is not significantly better than the intercept only model.</p>
</div>
<div id="exercises-3" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li>In the intercept offset model of penguin bill length by body mass, the estimates of differences in intercept were significant. Why do you think they are no longer significant in the interaction model? Hint: remember how intercepts and their standard errors are calculated with OLS!</li>
<li>Try running the same models, but substitute sex for species. Create all the following:
<ul>
<li>a sex-insensitive model</li>
<li>a sex-sensitive offset model</li>
<li>a sex-sensitive interaction model</li>
<li>provide a summary of each</li>
<li>identify the reference class</li>
<li>compare them with an ANOVA</li>
</ul></li>
<li>Now answer these questions:
<ul>
<li>how do you interpret the coefficients?</li>
<li>are there differences in average bill length between males and females?</li>
<li>differences in the relationship between bill length and body mass between males and females?</li>
<li>how do you interpret the results of the ANOVA test?</li>
</ul></li>
</ol>
</div>
</div>
<div id="Centering_And_Scaling" class="section level2">
<h2>Centering And Scaling</h2>
<p>Above, we made a model of penguin bill length as a function of body mass. This proved to be significant (as expected). However, it also has an intercept that is nonsensical. A penguin with zero mass has an expected bill length of 26.899 mm. What?!!! This is a class example where we would want to center our predictor variable (in this case, body mass) around its mean.</p>
<div id="centering" class="section level3">
<h3>Centering</h3>
<p>There simplest way to center a variable in R involves the subtraction operator <code>-</code> and the <code>mean()</code> or <code>median()</code> function, depending on which measure of central tendency seems more appropriate for your variable. We can also wrap this in <code>mutate()</code>.</p>
<pre class="r"><code>penguins &lt;- penguins %&gt;% 
  mutate(
    body_mass_cntr = body_mass_g - mean(body_mass_g, na.rm = TRUE)
  )</code></pre>
<p>This code says, in effect, “Update the penguins table by adding a variable representing the mean-centered body mass of each penguin.” Now let’s have a look at an updated model with the centered variable. Notice that we used <code>na.rm = TRUE</code> to ignore missing values! If we hadn’t, the variable would be filled with <code>NA</code> or missing values.</p>
<pre class="r"><code>lm_base_centered &lt;- lm(bill_length_mm ~ body_mass_cntr, data = penguins)

summary(lm_base_centered)
## 
## Call:
## lm(formula = bill_length_mm ~ body_mass_cntr, data = penguins)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -10.125  -3.043  -0.809   2.071  16.111 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    4.39e+01   2.38e-01   184.9   &lt;2e-16 ***
## body_mass_cntr 4.05e-03   2.97e-04    13.6   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.39 on 340 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.354,  Adjusted R-squared:  0.352 
## F-statistic:  186 on 1 and 340 DF,  p-value: &lt;2e-16</code></pre>
</div>
<div id="scaling" class="section level3">
<h3>Scaling</h3>
<p>I don’t know about you all, but millimeters don’t mean a hell of a lot to me. And not just because I’m from the United States! They’re tiny increments, which are hard to think about in general. To make the model slightly more intuitive, then, we can scale bill length, converting it to a different unit of measure, specifically centimeters.</p>
<pre class="r"><code>penguins &lt;- penguins %&gt;% 
  mutate(
    bill_length_cm = bill_length_mm/10
  )

lm_base_sc &lt;- lm(bill_length_cm ~ body_mass_cntr, data = penguins)

summary(lm_base_sc)
## 
## Call:
## lm(formula = bill_length_cm ~ body_mass_cntr, data = penguins)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.0125 -0.3043 -0.0809  0.2071  1.6111 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    4.39e+00   2.38e-02   184.9   &lt;2e-16 ***
## body_mass_cntr 4.05e-04   2.97e-05    13.6   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.439 on 340 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.354,  Adjusted R-squared:  0.352 
## F-statistic:  186 on 1 and 340 DF,  p-value: &lt;2e-16</code></pre>
<p>Much better. This model tells us that for the average body mass, the mean or expected bill length is 4.392 centimeters.</p>
</div>
<div id="standardizing" class="section level3">
<h3>Standardizing</h3>
<p>Does body mass or flipper length have a stronger effect on bill length? This is a somewhat confused question because the relationships aren’t actually causal in nature, so ‘effect’ is not the right word. Putting that aside, however, there is also the problem that these variables have different units of measure. To make them more comparable in a linear model, we can standardize them, converting them both to z-scores. Note that this is also a form of scaling, but it’s a scaling that ensures all variables are now available in the same units. That’s not quite right. In fact, the units are, in a sense, inherent to variables like mass and length. Standardizing them, however, gives us a precise way of answering the question: what is the equivalent in mass for a unit change in length? The z-score is one specific way of answer that.</p>
<p>Specifically, a z-score is mean centered and divided by the standard deviation. In a formula, that’s</p>
<p><span class="math display">\[z_i = \frac{x_i - \bar{x}}{s_x}\]</span></p>
<p>The base <code>scale()</code> function does this, but it works on matrices, which are a special sort of table where all the data are of the same type, rather than a single variable or vector. It, therefore, returns a vector as output, too. This is not useful for working with dplyr verbs, which all operate on variables and return variables. As a workaround, we can define our own function. Let’s call it <code>standardize()</code>.</p>
<pre class="r"><code>standardize &lt;- function(x, na.rm = TRUE){ 
  
  barx &lt;- mean(x, na.rm = na.rm)
  
  s &lt;- sd(x, na.rm = na.rm)
  
  (x - barx)/s 
  
}</code></pre>
<p>Let’s not dwell too much on this, as I’m not teaching you how do be a <em>programmer</em>. Instead, let’s just note a few things about it and move on. First, you are assigning a <code>function</code> with <code>&lt;-</code> to the name <code>standardize</code>. Second, you specify the functions arguments inside the parantheses. In this case, there’s <code>x</code>, the variable being standardized, and <code>na.rm</code>, which we pass on to the <code>mean()</code> and <code>sd()</code> function to tell them to ignore missing values. Finally, you specify what the function does inside the curly brackets. In this case, it subtracts the mean of <code>x</code> from each value of <code>x</code> and then divides those by the standard deviation. Hence, it provides a standardized z-score. Here’s an example of how to use it:</p>
<pre class="r"><code>x &lt;- 1:10

x[4] &lt;- NA

x
##  [1]  1  2  3 NA  5  6  7  8  9 10
standardize(x)
##  [1] -1.476 -1.160 -0.843     NA -0.211  0.105  0.422  0.738  1.054  1.370</code></pre>
<p>Now, we can use this in a call to <code>mutate()</code> like so.</p>
<pre class="r"><code>penguins &lt;- penguins %&gt;% 
  mutate(
    flipper_length_z = standardize(flipper_length_mm),
    body_mass_z = standardize(body_mass_g)
  )</code></pre>
<p>And now we can use it in a model.</p>
<pre class="r"><code># there&#39;s too much text here to put it all on one line, 
# so I spread it out across several to hopefully make it more readable

lm_standardized &lt;- 
  lm(
    bill_length_mm ~ flipper_length_z + body_mass_z, 
    data = penguins
  )

summary(lm_standardized)
## 
## Call:
## lm(formula = bill_length_mm ~ flipper_length_z + body_mass_z, 
##     data = penguins)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -8.806 -2.590 -0.705  1.991 18.829 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        43.922      0.223  196.97  &lt; 2e-16 ***
## flipper_length_z    3.120      0.455    6.86  3.3e-11 ***
## body_mass_z         0.531      0.455    1.17     0.24    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.12 on 339 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.433,  Adjusted R-squared:  0.43 
## F-statistic:  129 on 2 and 339 DF,  p-value: &lt;2e-16</code></pre>
<p>Strange. When flipper length is added to the model, body mass is no longer significant.</p>
</div>
<div id="exercises-4" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li>Why do you think body mass is no longer significant in the final model of bill length?</li>
<li>What test would you perform to investigate this result? Try it out and see what result it gives you.</li>
<li>Try standardizing bill depth using <code>mutate()</code> and make a model of bill length by bill depth. Make sure to summarize the model.</li>
</ol>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
