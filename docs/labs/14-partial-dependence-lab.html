<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.329">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2023-04-11">
<meta name="description" content="(Stats) Making sense of covariance in context. (R) Estimating and visualizing partial dependence.">
<title>Quantitative Analysis of Archaeological Data - Lab 14: Partial Dependence</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">QAAD</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../classes.html">
 <span class="menu-text">Classes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../help.html">
 <span class="menu-text">Help</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#outline" id="toc-outline" class="nav-link active" data-scroll-target="#outline">Outline</a>
  <ul class="collapse">
<li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#r-packages" id="toc-r-packages" class="nav-link" data-scroll-target="#r-packages">R Packages</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  </ul>
</li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li>
<a href="#warm-up" id="toc-warm-up" class="nav-link" data-scroll-target="#warm-up">Warm-up</a>
  <ul class="collapse">
<li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul>
</li>
  <li>
<a href="#inverse-link" id="toc-inverse-link" class="nav-link" data-scroll-target="#inverse-link">Inverse Link</a>
  <ul class="collapse">
<li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1">Exercises</a></li>
  </ul>
</li>
  <li>
<a href="#ggeffects" id="toc-ggeffects" class="nav-link" data-scroll-target="#ggeffects"><code>ggeffects</code></a>
  <ul class="collapse">
<li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2">Exercises</a></li>
  </ul>
</li>
  <li>
<a href="#partial-dependence" id="toc-partial-dependence" class="nav-link" data-scroll-target="#partial-dependence">Partial dependence</a>
  <ul class="collapse">
<li><a href="#exercises-3" id="toc-exercises-3" class="nav-link" data-scroll-target="#exercises-3">Exercises</a></li>
  </ul>
</li>
  <li><a href="#homework" id="toc-homework" class="nav-link" data-scroll-target="#homework">Homework</a></li>
  </ul></nav>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Lab 14: Partial Dependence</h1>
</div>

<div>
  <div class="description">
    <p>(Stats) Making sense of covariance in context. (R) Estimating and visualizing partial dependence.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 11, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header><section id="outline" class="level2"><h2 class="anchored" data-anchor-id="outline">Outline</h2>
<section id="objectives" class="level3"><h3 class="anchored" data-anchor-id="objectives">Objectives</h3>
<p>This lab will guide you through the process of</p>
<ol type="1">
<li>Predicting with GLMs</li>
<li>Back-transforming estimates and standard errors</li>
<li>Estimating partial dependence</li>
<li>Visualizing partial dependence</li>
</ol></section><section id="r-packages" class="level3"><h3 class="anchored" data-anchor-id="r-packages">R Packages</h3>
<p>We will be using the following packages:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/archdata/index.html">archdata</a></li>
<li><a href="https://strengejacke.github.io/ggeffects">ggeffects</a></li>
<li><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></li>
<li><a href="https://www.tidyverse.org">tidyverse</a></li>
<li><a href="https://sjmgarnier.github.io/viridis/">viridis</a></li>
</ul>
<p>⚠️ Don’t forget to install <code>ggeffects</code> with <code>install.packages("ggeffects")</code>. Best to run this in the console!</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">archdata</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/">ggeffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="data" class="level3"><h3 class="anchored" data-anchor-id="data">Data</h3>
<ul>
<li>
<code>DartPoints</code>
<ul>
<li>Includes measurements of 91 Archaic dart points recovered during surface surveys at Fort Hood, Texas.</li>
<li>package: <code>archdata</code>
</li>
<li>reference: <a href="https://cran.r-project.org/web/packages/archdata/archdata.pdf" class="uri">https://cran.r-project.org/web/packages/archdata/archdata.pdf</a>
</li>
</ul>
</li>
<li>
<code>penguins</code>
<ul>
<li>Includes measurements for penguin species, island in Palmer Archipelago, size (flipper length, body mass, bill dimensions), and sex.</li>
<li>package: <code>palmerpenguins</code>
</li>
<li>reference: <a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="uri">https://allisonhorst.github.io/palmerpenguins/reference/penguins.html</a>
</li>
</ul>
</li>
<li>
<code>Snodgrass</code>
<ul>
<li>Includes measurements of size, location, and contents of 91 pit houses at the Snodgrass site in Butler County, Missouri.</li>
<li>reference: <a href="https://cran.r-project.org/web/packages/archdata/archdata.pdf" class="uri">https://cran.r-project.org/web/packages/archdata/archdata.pdf</a>
</li>
</ul>
</li>
</ul></section></section><section id="motivation" class="level2"><h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>With the exception of pure mathematics and maybe fundamental physics, most of our reasoning about the world and our place in it is <em>defeasible</em>, meaning additional information (or additional premises) can alter the goodness of the conclusions we want to draw. If I strike a dry, well-made match, for example, I feel pretty confident that it will light. If I strike a dry, well-made match <em>in the vacuum of space</em>, however, it probably won’t light. Whether the match strikes or not is a Bernoulli outcome, of course, but the general point holds for any discrete or continuous outcome. Its values will only partially depend on the values of a specific covariate or predictor variable. When we fit a simple linear model, we’re sort of just hoping that this problem takes care of itself or, at the very least, that we have good theoretical reasons for thinking it’s not a problem to begin with. When we fit a general linear model, though, or, for that matter, any model with multiple covariates, we have to be a little more deliberate in how we approach this issue. This is especially true when our model includes lots of interactions between and non-linear transformations of variables. Basically, the more complicated the model, the harder it is to summarize the contribution of a covariate using a single number, like coefficient estimate.</p>
<p>In this lab, we are going to focus on how we <em>visualize</em> partial dependence, meaning how we visualize the relationship between an outcome and a single covariate (call it the <em>target</em> variable) while in some sense holding the other covariates fixed. These are sometimes referred to as partial dependence plots (or PDPs).</p>
</section><section id="warm-up" class="level2"><h2 class="anchored" data-anchor-id="warm-up">Warm-up</h2>
<p>As a gentle warm-up to generating PDPs, let’s remind ourselves how to visualize an estimated trend in a simple linear model. The model we are going to visualize is a model of bill length by body mass fit to the Palmer Penguins data set.</p>
<p>As always, we’ll start by visualizing the data.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># clean up data, remove rows with missing data</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Bill Length (mm)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>What is the relationship here? Let’s see if a linear model can help us out.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">flipper_length_mm</span>, </span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>  data <span class="op">=</span> <span class="va">penguins</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">penguins_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = bill_length_mm ~ flipper_length_mm, family = gaussian, </span></span>
<span><span class="co">#&gt;     data = penguins)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt; -8.637  -2.698  -0.579   2.066  19.095  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                   Estimate Std. Error t value            Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)        -7.2186     3.2717   -2.21               0.028 *  </span></span>
<span><span class="co">#&gt; flipper_length_mm   0.2548     0.0162   15.69 &lt;0.0000000000000002 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 17.2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 9928.9  on 332  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 5693.9  on 331  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 1896</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we use the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function to generate estimated values for bill length at observed values of flipper length. We then use <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> to visualize the trend line (the estimated or modeled values).</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">penguins_model</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">bill_length_mm</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Bill Length (mm)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">fit</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>A simple linear trend as expected. To get the standard errors, we can run <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> with the argument <code>se.fit = TRUE</code>. We’ll then add the intervals to the plot with the function <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon()</a></code> like so.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">penguins_model</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ fit           : Named num [1:333] 38.9 40.2 42.5 42 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:333] "1" "2" "3" ...</span></span>
<span><span class="co">#&gt;  $ se.fit        : Named num [1:333] 0.396 0.333 0.247 0.262 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:333] "1" "2" "3" ...</span></span>
<span><span class="co">#&gt;  $ residual.scale: num 4.15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a list with three items: <code>fit</code>, <code>se.fit</code>, and <code>residual.scale</code>. The <code>fit</code> is just the estimated response, <code>se.fit</code> the standard error of predicted means, and <code>residual.scale</code> the residual standard deviations. Multiplying the standard error (<code>se.fit</code>) by two and adding/subtracting that value from the <code>fit</code> gives the 95% confidence intervals.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    fit <span class="op">=</span> <span class="va">estimates</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>    se <span class="op">=</span> <span class="va">estimates</span><span class="op">$</span><span class="va">se.fit</span>,</span>
<span>    conf_lo <span class="op">=</span> <span class="va">fit</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">se</span>, <span class="co"># lower confidence interval</span></span>
<span>    conf_hi <span class="op">=</span> <span class="va">fit</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">se</span>  <span class="co"># higher confidence interval</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, ymin <span class="op">=</span> <span class="va">conf_lo</span>, ymax <span class="op">=</span> <span class="va">conf_hi</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"gray85"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">fit</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">bill_length_mm</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Bill Length (mm)"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<section id="exercises" class="level3"><h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<ol type="1">
<li>Build a model of penguin flipper length by body mass.
<ul>
<li>Make sure to visualize your data first! Make a scatter plot!</li>
<li>Generate model fit and estimates for confidence intervals using <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> and <code>se.fit = TRUE</code>.</li>
</ul>
</li>
<li>Now visualize the response.
<ul>
<li>Add the confidence interval using <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon()</a></code>.</li>
<li>Now plot the modeled relationship between flipper length and body mass using <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code>.</li>
</ul>
</li>
</ol></section></section><section id="inverse-link" class="level2"><h2 class="anchored" data-anchor-id="inverse-link">Inverse Link</h2>
<p>A Gaussian GLM uses an identity link function, which is just a fancy way of saying it doesn’t transform the response variable. That means predictions made with a Gaussian GLM are already on the scale of the response. In the model above, bill length was measured in millimeters and predictions were returned in millimeters. Unfortunately, logistic and Poisson regression are a little bit more complicated than that because they apply logit and log transformations to the response variable. That means predictions made with logistic and Poisson models return predictions on the logit and log scales respectively. These are not always the easiest scales to interpret, so it’s customary to “back transform” the predictions onto the response scale. The transformations applied to the response variable are called link functions, so the functions applied to the predictions to back transform are often referred to as inverse link functions.</p>
<p>In this section, we’ll learn how to access and apply an inverse link to predictions made by a logistic regression model. We’ll be using the <code>Snodgrass</code> data to answer the following</p>
<p><strong>Question</strong> Does the size of a house structure (measured in square feet) make it more or less likely that the structure is found inside the inner walls of a site?</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"Snodgrass"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">snodgrass</span> <span class="op">&lt;-</span> <span class="va">Snodgrass</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="va">tolower</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">inside</span>, <span class="va">area</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">inside</span> <span class="op">==</span> <span class="st">"Inside"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span><span class="va">Snodgrass</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As always, we’ll plot these data using a scatterplot.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">snodgrass</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">inside</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Area (sq ft)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Inside inner wall"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>And, now we’ll fit a GLM with a binomial error distribution and a logit link function. Recall that the logit link is</p>
<p><span class="math display">\[logit(p) = log\left(\frac{p}{1-p}\right)\]</span></p>
<p>and that we’re modeling this value as a linear function of covariates:</p>
<p><span class="math display">\[log\left(\frac{p}{1-p}\right) = \beta X\]</span></p>
<p>So, here’s how we fit that model in R.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">glm_snodgrass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">inside</span> <span class="op">~</span> <span class="va">area</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">snodgrass</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">glm_snodgrass</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = inside ~ area, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = snodgrass)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt; -2.110  -0.481  -0.184   0.288   2.571  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value  Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -8.66307    1.81844   -4.76 0.0000019 ***</span></span>
<span><span class="co">#&gt; area         0.03476    0.00751    4.63 0.0000037 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 123.669  on 90  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  57.728  on 89  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 61.73</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To predict with this, we use the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function, just as we did above.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">glm_snodgrass</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># showing the first five fit</span></span>
<span><span class="va">fit</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;      1      2      3      4      5 </span></span>
<span><span class="co">#&gt; -3.658  0.235  1.973  7.031  5.588</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that these are on the logit scale (and that they have values less than zero and greater than one). To get these back onto the scale of the response (i.e., probability), we need to apply the inverse link function to these data. For logistic regression, the inverse link is just the logistic function!</p>
<p><span class="math display">\[p = \frac{1}{1+exp(-\beta X)}\]</span></p>
<p>To do that, we extract the function from the error distribution of the model with the <code><a href="https://rdrr.io/r/stats/family.html">family()</a></code> function and the <code>$</code> operator.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">inverse_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">family</a></span><span class="op">(</span><span class="va">glm_snodgrass</span><span class="op">)</span><span class="op">$</span><span class="va">linkinv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a function, so we can now apply it to our fit.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  logit <span class="op">=</span> <span class="va">fit</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>  probability <span class="op">=</span> <span class="fu">inverse_link</span><span class="op">(</span><span class="va">fit</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span><span class="co">#&gt;    logit probability</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 -3.66       0.0251</span></span>
<span><span class="co">#&gt; 2  0.235      0.559 </span></span>
<span><span class="co">#&gt; 3  1.97       0.878 </span></span>
<span><span class="co">#&gt; 4  7.03       0.999 </span></span>
<span><span class="co">#&gt; 5  5.59       0.996</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use this now to plot the estimated response over our observations.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">snodgrass</span> <span class="op">&lt;-</span> <span class="va">snodgrass</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    logit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">glm_snodgrass</span><span class="op">)</span>,</span>
<span>    probability <span class="op">=</span> <span class="fu">inverse_link</span><span class="op">(</span><span class="va">logit</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">snodgrass</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">inside</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">probability</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#A20000"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Area (sq ft)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Inside inner wall"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>To get the standard errors, we can run <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> with the argument <code>se.fit = TRUE</code> again. Note that the fit and standard error are both on the logit scale this time, so we need to apply the inverse link function.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">glm_snodgrass</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">snodgrass</span> <span class="op">&lt;-</span> <span class="va">snodgrass</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    logit <span class="op">=</span> <span class="va">estimates</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>    se <span class="op">=</span> <span class="va">estimates</span><span class="op">$</span><span class="va">se.fit</span>,</span>
<span>    probability <span class="op">=</span> <span class="fu">inverse_link</span><span class="op">(</span><span class="va">logit</span><span class="op">)</span>,</span>
<span>    conf_hi <span class="op">=</span> <span class="fu">inverse_link</span><span class="op">(</span><span class="va">logit</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">se</span><span class="op">)</span>,</span>
<span>    conf_lo <span class="op">=</span> <span class="fu">inverse_link</span><span class="op">(</span><span class="va">logit</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">se</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we add the <code>logit</code> response and <code>se</code> or standard errors to the <code>snodgrass</code> table by extracting the <code>fit</code> and <code>se.fit</code> items from the <code>estimates</code> list. We then convert the <code>logit</code> response to a <code>probability</code> by applying the <code>inverse_link()</code> function. Next, we estimate the upper confidence line <code>conf_hi</code> by applying the <code>inverse_link()</code> to the sum of the <code>logit</code> response and 2 times the standard error (<code>se</code>). To get the lower confidence line <code>conf_lo</code>, we do the same, but taking the difference.</p>
<p>Now we have everything we need to plot the confidence ribbon with <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon()</a></code>. Notice that I add the ribbon to the plot before adding the observed points and the estimated trend line! This ensures that points and line are not obscured by the confidence ribbon.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">snodgrass</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">area</span>, ymin <span class="op">=</span> <span class="va">conf_lo</span>, ymax <span class="op">=</span> <span class="va">conf_hi</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"gray75"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">inside</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">probability</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#A20000"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Area (sq ft)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Inside inner wall"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<section id="exercises-1" class="level3"><h3 class="anchored" data-anchor-id="exercises-1">Exercises</h3>
<p>For these exercises, we’ll use the <code>DartPoints</code> dataset from the <code>archdata</code> package. As we did in the previous lab, we are going to use length to see if we can discriminate Pedernales dart points from the other dart points.</p>
<ol type="1">
<li>First, load the <code>DartPoints</code> table with <code>data("DartPoints")</code>.</li>
<li>Now, let’s do some data wrangling with this table. Make sure to assign it back to your table, so that it saves the changes!And bonus points if you can put this all through one pipe!
<ul>
<li>Change all the names to lowercase with <code>rename_with(tolower)</code>.</li>
<li>Use <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to grab the name (<code>name</code>) and length (<code>length</code>) variables.</li>
<li>Use <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> to rename <code>name</code> to <code>type</code>. Hint: use the <code>"new_name" = old_name</code> syntax, for example, <code>"length" = l</code>.</li>
<li>
<strong>THIS IS IMPORTANT!!!</strong> Use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> to add a column <code>pedernales</code> that is <code>1</code> if the type is <code>Pedernales</code> and 0 otherwise. Hint: fill in the ellipsis in <code>mutate(pedernales = ifelse(type == ...))</code>.</li>
</ul>
</li>
<li>Make a scatter plot of the data.<br>
</li>
<li>Build a GLM of the Pedernales type as a function of dart length using a Binomial distribution and the logit link.</li>
<li>Use <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> with <code>se.fit = TRUE</code> and assign this to an object called <code>estimates</code>.</li>
<li>Extract the inverse link function from the model with <code>family()$linkinv</code> and give it the name <code>inverse_link</code>.</li>
<li>Now, add the logit, probability, standard errors, and inverse-transformed standard errors to the <code>darts</code> table, applying the inverse link function where necessary.</li>
<li>Plot the confidence ribbon. Make sure to add the ribbon to the plot before adding observations or the trend line!</li>
</ol></section></section><section id="ggeffects" class="level2"><h2 class="anchored" data-anchor-id="ggeffects"><code>ggeffects</code></h2>
<p>Now, let’s get to partial dependence. Here, we’re going to build a slightly more complicated model of bill length that incorporates information about the species of the penguin. This involves the use of a qualitative or categorical variable which gets coded in the model using dummy variables. In this case, we are estimating different intercepts for each species under the assumption that some species have longer bills than others on average.</p>
<p>Before we do that, though, let’s visualize the data!</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">bill_length_mm</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">species</span>, fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    discrete <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_color_viridis</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>    discrete <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Bill Length (mm)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Now the model.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">species</span>, </span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>  data <span class="op">=</span> <span class="va">penguins</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">penguins_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = bill_length_mm ~ flipper_length_mm + species, family = gaussian, </span></span>
<span><span class="co">#&gt;     data = penguins)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt; -6.676  -1.748   0.024   1.783  12.387  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                   Estimate Std. Error t value             Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)        -2.4802     4.0795   -0.61                 0.54    </span></span>
<span><span class="co">#&gt; flipper_length_mm   0.2173     0.0214   10.14 &lt; 0.0000000000000002 ***</span></span>
<span><span class="co">#&gt; speciesChinstrap    8.7669     0.4006   21.88 &lt; 0.0000000000000002 ***</span></span>
<span><span class="co">#&gt; speciesGentoo       2.8489     0.6641    4.29             0.000024 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 6.75)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 9928.9  on 332  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 2219.9  on 329  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 1587</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a wee-bit more complicated than the simple GLM we fit above, so we are going to use a new package called <code>ggeffects</code> to model the relationship. The process is still the same. First, we generate a table of data by using the model to estimate the response across the range of the covariate. Then, we use that data to plot the response. In this case, we will use the <code><a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html">ggpredict()</a></code> function from <code>ggeffects</code> to generate a table of data for plotting. Then, we will use <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> to generate the figure.</p>
<p>The <code><a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html">ggpredict()</a></code> function is extremely useful. In fact, you might even consider using it to generate data for visualizing GLMs and even simple linear models, as it will do all the steps we outlined above in one fell swoop. Like with the base <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function, it’s first argument is a fitted model. You can also specify what variables to visualize (in this case, we only have one, <code>flipper_length_mm</code>), and you can tell it what levels of a factor variable (in this case, <code>species</code>) to visualize with. You provide this to the <code>terms</code> argument.</p>
<p>The full function call is this.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html">ggpredict</a></span><span class="op">(</span></span>
<span>  <span class="va">penguins_model</span>,</span>
<span>  terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"flipper_length_mm"</span>, <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">estimates</span></span>
<span><span class="co">#&gt; # Predicted values of bill_length_mm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # species = Adelie</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; flipper_length_mm | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------------------</span></span>
<span><span class="co">#&gt;               170 |     34.46 | [33.51, 35.40]</span></span>
<span><span class="co">#&gt;               180 |     36.63 | [36.03, 37.23]</span></span>
<span><span class="co">#&gt;               190 |     38.80 | [38.38, 39.22]</span></span>
<span><span class="co">#&gt;               200 |     40.97 | [40.38, 41.57]</span></span>
<span><span class="co">#&gt;               220 |     45.32 | [43.99, 46.65]</span></span>
<span><span class="co">#&gt;               240 |     49.67 | [47.52, 51.81]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # species = Chinstrap</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; flipper_length_mm | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------------------</span></span>
<span><span class="co">#&gt;               170 |     43.22 | [41.97, 44.48]</span></span>
<span><span class="co">#&gt;               180 |     45.40 | [44.49, 46.31]</span></span>
<span><span class="co">#&gt;               190 |     47.57 | [46.90, 48.24]</span></span>
<span><span class="co">#&gt;               200 |     49.74 | [49.10, 50.39]</span></span>
<span><span class="co">#&gt;               220 |     54.09 | [52.89, 55.28]</span></span>
<span><span class="co">#&gt;               240 |     58.43 | [56.47, 60.39]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # species = Gentoo</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; flipper_length_mm | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------------------</span></span>
<span><span class="co">#&gt;               170 |     37.31 | [35.26, 39.35]</span></span>
<span><span class="co">#&gt;               180 |     39.48 | [37.84, 41.12]</span></span>
<span><span class="co">#&gt;               190 |     41.65 | [40.41, 42.89]</span></span>
<span><span class="co">#&gt;               200 |     43.82 | [42.96, 44.69]</span></span>
<span><span class="co">#&gt;               220 |     48.17 | [47.69, 48.65]</span></span>
<span><span class="co">#&gt;               240 |     52.51 | [51.45, 53.58]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While this printout is somewhat involved, under the hood, it’s really just a <code>tibble</code> with six important columns:</p>
<ol type="1">
<li>
<code>x</code> - the predictor variable,</li>
<li>
<code>predicted</code> - the estimated response,</li>
<li>
<code>std.error</code> - the standard error</li>
<li>
<code>conf.low</code> - the lower confidence level at 95%, so roughly <span class="math inline">\(predicted - 2\cdot std.error\)</span>.</li>
<li>
<code>conf.high</code> - the upper confidence level at 95%, so roughly <span class="math inline">\(predicted + 2\cdot std.error\)</span>.</li>
<li>
<code>species</code> - the levels or species in the factor variable used, in this case, to estimate random effects.</li>
</ol>
<p>So, we can use these variables in our <code>estimates</code> table to plot the responses. Here, we are going to do all of the following.</p>
<ol type="1">
<li>We are going to add the original observations as points.</li>
<li>We’ll also use the <code>viridis</code> color package to apply the <code>viridis</code> color palette to the species groups. Note that we use the same <code>name = "Species"</code> for both <code><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis()</a></code> and <code><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_color_viridis()</a></code>. This does two things.
<ul>
<li>First, and most simply, it sets the title of the legend.</li>
<li>Second, it ensures that the legend for color and fill are combined into one legend.</li>
</ul>
</li>
<li>To make the points more visible, we
<ul>
<li>Set <code>color = species</code> and <code>fill = species</code> in the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>.</li>
<li>Reduce the opacity of the fill to 0.5 (in the <code><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis()</a></code> function!), so we can see overlap in points.</li>
<li>We also set <code>shape = 21</code>, so we can add a darker border around each point to delineate them.</li>
</ul>
</li>
<li>The facet labels are redundant with the color scheme and legend, so we will remove those with <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code>.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span>, color <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.15</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">penguins</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">bill_length_mm</span>, color <span class="op">=</span> <span class="va">species</span>, fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    discrete <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">predicted</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_color_viridis</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>    discrete <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># facet_wrap(~ species, ncol = 3) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># remove gray box above each facet</span></span>
<span>    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># remove text labels above each facet</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Bill length (mm)"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>This figure has one very serious flaw. It plots the response along the full range of flipper length irrespective of the range of each species. This is a challenge of working with the <code>ggeffects</code> package, unfortunately. If someone can find a good work around for this, I’d like to see it!</p>
<p>If you prefer, the <code>ggeffects</code> package also has an automatic <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> method for generating a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> of the response. In this case, it’s nice to use this because of the difficulty of plotting within the range of the actual data, but it has its own frustrating trade-offs that I won’t get into now.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">estimates</span>,</span>
<span>  rawdata <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  limit.range <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  colors <span class="op">=</span> <span class="st">"viridis"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Bill length (mm)"</span>,</span>
<span>    title <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<section id="exercises-2" class="level3"><h3 class="anchored" data-anchor-id="exercises-2">Exercises</h3>
<ol type="1">
<li>Build a model of penguin flipper length by body mass and species (let the intercepts vary by species).
<ul>
<li>Make sure to visualize your data first! Make a scatter plot! And color points by species!</li>
<li>Generate model fit and estimates for confidence intervals using <code><a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html">ggpredict()</a></code> with <code>terms = c("body_mass_g", "species")</code>.</li>
</ul>
</li>
<li>Now visualize the response.
<ul>
<li>You can use the <code>ggplot2</code> or <code>plot</code> method.<br>
</li>
<li>Add the confidence interval.</li>
<li>Add the modeled relationship.</li>
<li>Add the data points to the model.</li>
</ul>
</li>
</ol></section></section><section id="partial-dependence" class="level2"><h2 class="anchored" data-anchor-id="partial-dependence">Partial dependence</h2>
<p>OK, so here’s the basic idea behind partial dependence. For demonstration purposes, let’s say our data set is this subset of the penguins table:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">bill_length_mm</span>, <span class="va">body_mass_g</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_data</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 3</span></span>
<span><span class="co">#&gt;    flipper_length_mm bill_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;                &lt;int&gt;          &lt;dbl&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1               187           34.5        2900</span></span>
<span><span class="co">#&gt;  2               197           52.2        3450</span></span>
<span><span class="co">#&gt;  3               211           45.4        4800</span></span>
<span><span class="co">#&gt;  4               195           42.1        4000</span></span>
<span><span class="co">#&gt;  5               224           50          5350</span></span>
<span><span class="co">#&gt;  6               201           41.5        4000</span></span>
<span><span class="co">#&gt;  7               195           41.5        4300</span></span>
<span><span class="co">#&gt;  8               198           50.2        3775</span></span>
<span><span class="co">#&gt;  9               199           37.5        4475</span></span>
<span><span class="co">#&gt; 10               210           52          4800</span></span>
<span><span class="co">#&gt; 11               172           37.9        3150</span></span>
<span><span class="co">#&gt; 12               187           36.2        3300</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we fit our penguins model to this data.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">body_mass_g</span>,</span>
<span>  data <span class="op">=</span> <span class="va">my_data</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s say we want to know how bill length varies as a function of body mass while holding flipper length constant. Here’s how we do that. First, we take the range of flipper length and choose and build a grid with arbitrary number of values within that range, so</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="va">x_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span></span>
<span>  <span class="va">my_data</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">flipper_length_mm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">flipper_length_mm</span><span class="op">)</span>, length <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_grid</span></span>
<span><span class="co">#&gt; [1] 172 198 224</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, our grid has 3 values. Now, for each of those values, we take our original data set, <code>my_data</code>, and set all the values of flipper length to that value and then estimate the response with our model. We then take the mean of those estimates. This gives us the average response of bill length at each of those three values of flipper length.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_data1</span> <span class="op">&lt;-</span> <span class="va">my_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="va">x_grid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_data1</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 3</span></span>
<span><span class="co">#&gt;    flipper_length_mm bill_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;                &lt;dbl&gt;          &lt;dbl&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1               172           34.5        2900</span></span>
<span><span class="co">#&gt;  2               172           52.2        3450</span></span>
<span><span class="co">#&gt;  3               172           45.4        4800</span></span>
<span><span class="co">#&gt;  4               172           42.1        4000</span></span>
<span><span class="co">#&gt;  5               172           50          5350</span></span>
<span><span class="co">#&gt;  6               172           41.5        4000</span></span>
<span><span class="co">#&gt;  7               172           41.5        4300</span></span>
<span><span class="co">#&gt;  8               172           50.2        3775</span></span>
<span><span class="co">#&gt;  9               172           37.5        4475</span></span>
<span><span class="co">#&gt; 10               172           52          4800</span></span>
<span><span class="co">#&gt; 11               172           37.9        3150</span></span>
<span><span class="co">#&gt; 12               172           36.2        3300</span></span>
<span></span>
<span><span class="va">e1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">penguins_model</span>, newdata <span class="op">=</span> <span class="va">new_data1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">e1</span></span>
<span><span class="co">#&gt;    1    2    3    4    5    6    7    8    9   10   11   12 </span></span>
<span><span class="co">#&gt; 34.8 33.3 29.7 31.9 28.3 31.9 31.1 32.4 30.6 29.7 34.1 33.7</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">e1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 31.8</span></span>
<span></span>
<span><span class="va">new_data2</span> <span class="op">&lt;-</span> <span class="va">my_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="va">x_grid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">e2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">penguins_model</span>, newdata <span class="op">=</span> <span class="va">new_data2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_data3</span> <span class="op">&lt;-</span> <span class="va">my_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="va">x_grid</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">e3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">penguins_model</span>, newdata <span class="op">=</span> <span class="va">new_data3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">partial_dependence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  flipper_length_mm <span class="op">=</span> <span class="va">x_grid</span>,</span>
<span>  bill_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">e1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">e2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">e3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">partial_dependence</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;   flipper_length_mm bill_length_mm</span></span>
<span><span class="co">#&gt;               &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1               172           31.8</span></span>
<span><span class="co">#&gt; 2               198           43.4</span></span>
<span><span class="co">#&gt; 3               224           55.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we end up with an estimate of partial dependence that looks like this.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">partial_dependence</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Bill length (mm)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Now, obviously, this would take many many lines of code to estimate the partial dependence for an arbitrary model and data set, especially if we increase the number of points on the grid. Fortunately, the <code>ggeffects</code> package will do these calculations for you. Let’s just run through a full example to see how that works.</p>
<p>First we build the model.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">body_mass_g</span> <span class="op">+</span> <span class="va">species</span>,</span>
<span>  data <span class="op">=</span> <span class="va">penguins</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">penguins_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = bill_length_mm ~ flipper_length_mm + body_mass_g + </span></span>
<span><span class="co">#&gt;     species, data = penguins)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt; -7.026  -1.526   0.123   1.427  10.731  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                   Estimate Std. Error t value             Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)       9.202600   3.966540    2.32               0.0210 *  </span></span>
<span><span class="co">#&gt; flipper_length_mm 0.099064   0.024101    4.11   0.0000499598995988 ***</span></span>
<span><span class="co">#&gt; body_mass_g       0.002911   0.000349    8.34   0.0000000000000021 ***</span></span>
<span><span class="co">#&gt; speciesChinstrap  9.364750   0.371388   25.22 &lt; 0.0000000000000002 ***</span></span>
<span><span class="co">#&gt; speciesGentoo     2.020637   0.612198    3.30               0.0011 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 5.58)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 9928.9  on 332  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 1831.4  on 328  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 1525</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we estimate partial dependence of bill length on flipper length for each species.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">partial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">penguins_model</span>, terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"flipper_length_mm"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And plot the result.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">partial</span>,</span>
<span>  rawdata <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  limit.range <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  colors <span class="op">=</span> <span class="st">"viridis"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Bill length (mm)"</span>,</span>
<span>    title <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="14-partial-dependence-lab_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Notice that when we control for body mass, the effect of flipper length on fill length is not as large!</p>
<section id="exercises-3" class="level3"><h3 class="anchored" data-anchor-id="exercises-3">Exercises</h3>
<ol type="1">
<li>Use the model in the last example to make a plot of the partial dependence of bill length on body mass.<br>
</li>
<li>How does it compare to the relationship estimated by the model with just bill length and body mass, which you made above?</li>
</ol></section></section><section id="homework" class="level2"><h2 class="anchored" data-anchor-id="homework">Homework</h2>
<p>No homework this week.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center">© 2023 Kenneth B. Vernon. Powered by <a href="https://quarto.org/">Quarto</a>.<br>
The source code for this site can be found at its <a href="https://github.com/kbvernon/qaad">Github repository</a>.</div>
  </div>
</footer>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>