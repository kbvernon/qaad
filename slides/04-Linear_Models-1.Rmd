---
title: "Lecture 04: Linear Models 1"  
date: 'Last updated: `r Sys.Date()`'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [xaringan-themer.css, custom_style.css]
    seal: TRUE
    nature:
      highlightStyle: magula
      highlightLines: TRUE
      countIncrementalSlides: TRUE
      ratio: '16:9'
---

```{r, include = FALSE}
source(here::here("slides", "before_chunk.R"))
```

## Lecture Outline


---

## Bivariate statistics

Explore the relationship between two variables:

```{r, fig.asp = 0.35, out.width = "75%"}

line_data <- tibble(
  x = seq(0, 10, length = 500),
  linear = x,
  nonlinear = dnorm(x, mean = 4)/max(dnorm(x, mean = 4)) * 7.5,
  positive = 0.7 * x + 2,
  negative = -0.3 * x + 7,
  weak = 0.1 * x,
  strong = 1.3 * x
) %>% 
  pivot_longer(-x, values_to = "y") %>% 
  arrange(name, x) %>% 
  mutate(
    relationship = case_when(
      name %in% c("linear", "nonlinear") ~ "Form",
      name %in% c("positive", "negative") ~ "Direction",
      name %in% c("weak", "strong") ~ "Strength",
      TRUE ~ NA_character_
    )
  ) %>% 
  select(relationship, name, x, y) %>% 
  filter(y <= 10)

line_labels <- tibble(
  relationship = c("Direction", "Form", "Strength"),
  x = 0, 
  y = 9.85
)

ggplot() +
  geom_line(
    data = line_data, 
    aes(x, y, group = name),
    color = "#477998",
    arrow = arrow(length=unit(0.20,"cm"), type = "closed")
  ) +
  geom_text(
    data = line_labels,
    aes(x, y, label = relationship),
    hjust = 0,
    vjust = 1,
    size = 5
  ) +
  ylim(0, 10) +
  facet_wrap(~relationship) +
  coord_fixed() +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    plot.margin = margin(),
    strip.background = element_blank(),
    strip.text = element_blank()
  )

remove(line_data, line_labels)

```


---

## Covariance

.pull-left[

Measure of the extent to which two variables vary together. 

$$ cov(x, y) = \frac{1}{n-1} \sum_{i=1}^{n}  (x_i - \bar{x})(y_i - \bar{y}) $$

* Sign reflects positive or negative trend, but magnitude depends on units of measure (e.g., $cm$ vs $km$).  
* Variance is the covariance of a variable with itself.  

]

.pull-right[

```{r}

# average height and weight for men in the UK
mean_height <- 175.3
mean_weight <- 83.6

body_data <- tibble(
  covariance = "Positive",
  height = sort(rnorm(50, mean = mean_height)), 
  weight = (mean_weight + (4 * scale(height)) + rnorm(50, sd = 2)) 
)

body_data <- body_data %>% 
  mutate(
    covariance = "Negative",
    weight = rev(weight)
    ) %>% 
  bind_rows(body_data, .)

body_labels <- tibble(
  covariance = c("Negative", "Positive"),
  x = min(body_data$height) - 0.1,
  y = with(body_data, mean(weight) + c(-1.8, 1.8))
)

bob <- ggplot(body_data, aes(height, weight)) +
  geom_hline(
    aes(yintercept = mean(weight)), 
    linetype = "dashed", 
    color = "gray55"
  ) +
  geom_vline(
    aes(xintercept = mean(height)), 
    linetype = "dashed", 
    color = "gray55"
  ) +
  geom_point(
    shape = 21,
    color = "#A20000",
    fill = alpha("#A20000", 0.6),
    size = 5
  ) +
  geom_text(
    data = body_labels,
    aes(x, y, label = covariance),
    hjust = 0,
    vjust = 0.5,
    size = 7
  ) +
  facet_wrap(~covariance, nrow = 2) +
  labs(
    x = "Height (cm)",
    y = "Weight (kg)"
  ) +
  theme(
    plot.margin = margin(),
    strip.background = element_blank(),
    strip.text = element_blank()
  )

bob

remove(body_labels, mean_weight, mean_height)

```

]


---

## Correlation

.pull-left[

Pearson's Correlation Coefficient

$$ r = \frac{cov(x,y)}{s_{x}s_y} $$

- Normalizes covariance (scale of -1 to 1) using standard deviations, $s$, thus making the magnitude of $r$ independent of units of measure.  

- Significance of $r$ can be tested by converting to a _t_-statistic and testing against a _t_-distribution with $n-2$ degrees of freedom.  

]

.pull-right[

```{r}

bob

remove(bob)

```

]


---

## Correlation is not causation!

<br>

```{r, fig.asp = 0.4, fig.width = 720/72, out.width = "70%", fig.cap = "Adapted from https://www.tylervigen.com/spurious-correlations"}

cage <- tibble(
  year = 1999:2009,
  films = c(2, 2, 2, 3, 1, 1, 2, 3, 4, 1, 4),
  drownings = c(109, 102, 102, 98, 85, 95, 96, 98, 123, 94, 102),
  helicopters = c(59, 64, 56, 48, 79, 75, 42, 49, 47, 69, 43)
) %>% 
  mutate(
    films_sc = scales::rescale(films, to = c(min(drownings), max(drownings)))
  )

film_color <- "#477998"
drowning_color <- "#F15A29"

ggplot(cage) + 
  geom_smooth(
    aes(year, drownings),
    color = alpha(drowning_color, 0.1),
    span = 0.4, 
    se = FALSE,
    size = 3
  ) +
  geom_smooth(
    aes(year, drownings),
    color = drowning_color, 
    span = 0.4, 
    se = FALSE,
    size = 0.6
  ) +
  geom_point(
    aes(year, drownings),
    shape = 21,
    color = drowning_color, 
    fill = "white",
    size = 2.5
  ) +
  geom_smooth(
    aes(year, films_sc),
    color = alpha(film_color, 0.1),
    span = 0.4, 
    se = FALSE,
    size = 3
  ) +
  geom_smooth(
    aes(year, films_sc),
    color = film_color, 
    span = 0.4, 
    se = FALSE,
    size = 0.6
  ) +
  geom_point(
    aes(year, films_sc),
    shape = 21,
    color = film_color, 
    fill = "white",
    size = 2.5
  ) +
  scale_x_continuous(
    expand = expansion(add = 0.2),
    breaks = seq(1999, 2009, by = 2)
  ) +
  scale_y_continuous(
    name = "Number of people who\ndrowned falling into a-pool",
    sec.axis = dup_axis(
      name = "Number of films\nNicolas Cage appeared in",
      breaks = with(cage, seq(min(drownings), max(drownings), length = 3)),
      labels = seq(1, 4, length = 3)
    )
  ) +
  annotate(
    geom = "text",
    x = 1999,
    y = 123,
    label = paste0(
      "r = ",
      with(cage, round(cor(films, drownings), digits = 2))
    ),
    hjust = 0,
    size = 6.5,
    color = "gray20"
  ) +
  labs(x = "Year") +
  theme(
    axis.text.y.left = element_text(color = drowning_color),
    axis.text.y.right = element_text(color = film_color),
    axis.title.y.left = element_text(color = drowning_color),
    axis.title.y.right = element_text(color = film_color)
  )
  
```

